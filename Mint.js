/**
 * interactive-mint.js
 * ржПржЗ рж╕рзНржХрзНрж░рж┐ржкрзНржЯржЯрж┐ ржПржХржЯрж┐ NFT ржорж┐ржирзНржЯ ржХрж░рж╛рж░ ржЬржирзНржп ржЯрж╛рж░рзНржорж┐ржирж╛рж▓рзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржХрж╛ржЫ ржерзЗржХрзЗ рж╕рж░рж╛рж╕рж░рж┐ ржЗржиржкрзБржЯ ржирзЗржпрж╝ред
 * ржПржЯрж┐ ржХрзЛржирзЛ ржлрж╛ржЗрж▓рзЗ ржЧрзЛржкржи рждржерзНржп рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзЗ ржирж╛, рждрж╛ржЗ ржПржЯрж┐ ржЕржзрж┐ржХ ржирж┐рж░рж╛ржкржж ржПржмржВ рж╕рж╣ржЬрзЗ ржмрзНржпржмрж╣рж╛рж░ржпрзЛржЧрзНржпред
 */

const { ethers } = require("ethers");
const readline = require('readline/promises');

// тЪая╕П ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг: ржмрзЗрж╢рж┐рж░ржнрж╛ржЧ NFT ржХржирзНржЯрзНрж░рж╛ржХрзНржЯрзЗ mint ржлрж╛ржВрж╢ржи ржирж┐ржЪрзЗрж░ ржорждрзЛ ржерж╛ржХрзЗред
// ржпржжрж┐ ржЯрж╛рж░рзНржЧрзЗржЯ ржХржирзНржЯрзНрж░рж╛ржХрзНржЯрзЗрж░ ржлрж╛ржВрж╢ржи ржнрж┐ржирзНржи рж╣ржпрж╝ (ржпрзЗржоржи: publicMint, claim), рждрж╛рж╣рж▓рзЗ ржЖржкржирж╛ржХрзЗ ржПржЗ ABI ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рждрзЗ рж╣ржмрзЗред
const contractABI = [
  "function mint(uint256 numberOfTokens)"
];

async function main() {
  const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
  });

  console.log("ЁЯЪА FCFS NFT Minting Bot ЁЯЪА");
  console.log("--------------------------------");

  // ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржХрж╛ржЫ ржерзЗржХрзЗ рж╕ржХрж▓ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ рждржерзНржп ржЗржиржкрзБржЯ ржирзЗржУржпрж╝рж╛
  const rpcUrl = await rl.question("https://eth-sepolia.api.onfinality.io/rpc?apikey=93d71d29-fa04-45b8-b574-3b4acb2856d5): ");
  const privateKey = await rl.question("ЁЯФС ржЖржкржирж╛рж░ Wallet Private Key ржкрзЗрж╕рзНржЯ ржХрж░рзБржи: ");
  const contractAddress = await rl.question("ЁЯУД NFT Contract Address ржкрзЗрж╕рзНржЯ ржХрж░рзБржи: ");
  const quantityStr = await rl.question("ЁЯФв ржХржпрж╝ржЯрж┐ NFT ржорж┐ржирзНржЯ ржХрж░рждрзЗ ржЪрж╛ржи?: ");
  const mintPriceStr = await rl.question("ЁЯТ░ ржПржХржЯрж┐ NFT-ржПрж░ ржжрж╛ржо ETH-ржП рж▓рж┐ржЦрзБржи (e.g., 0.05): ");
  
  rl.close();

  try {
    // ржЗржиржкрзБржЯржХрзЗ рж╕ржарж┐ржХ ржлрж░ржорзНржпрж╛ржЯрзЗ рж░рзВржкрж╛ржирзНрждрж░ ржХрж░рж╛
    const mintQuantity = parseInt(quantityStr);
    const mintPrice = ethers.parseEther(mintPriceStr);
    const totalCost = mintPrice * BigInt(mintQuantity);

    // рзз. ржкрзНрж░рзЛржнрж╛ржЗржбрж╛рж░рзЗрж░ рж╕рж╛ржерзЗ рж╕ржВржпрзЛржЧ
    const provider = new ethers.JsonRpcProvider(rpcUrl);
    console.log("\nтЬЕ Provider-ржПрж░ рж╕рж╛ржерзЗ рж╕ржВржпрзЛржЧ рж╕ржлрж▓ред");

    // рзи. ржУржпрж╝рж╛рж▓рзЗржЯ рж▓рзЛржб ржХрж░рж╛
    const wallet = new ethers.Wallet(privateKey, provider);
    console.log(`тЬЕ ржУржпрж╝рж╛рж▓рзЗржЯ рж▓рзЛржб рж╣ржпрж╝рзЗржЫрзЗ: ${wallet.address}`);

    // рзй. ржХржирзНржЯрзНрж░рж╛ржХрзНржЯрзЗрж░ ржЗржирж╕рзНржЯрзНржпрж╛ржирзНрж╕ рждрзИрж░рж┐ ржХрж░рж╛
    const contract = new ethers.Contract(contractAddress, contractABI, wallet);
    console.log(`тЬЕ ржХржирзНржЯрзНрж░рж╛ржХрзНржЯрзЗрж░ рж╕рж╛ржерзЗ рж╕ржВржпрзЛржЧ рж╕ржлрж▓: ${await contract.getAddress()}`);

    console.log("\nЁЯЪА ржорж┐ржирзНржЯ ржХрж░рж╛рж░ ржЬржирзНржп ржЯрзНрж░рж╛ржиржЬрзНржпрж╛ржХрж╢ржи ржкрж╛ржарж╛ржирзЛ рж╣ржЪрзНржЫрзЗ...");
    console.log(`   - ржкрж░рж┐ржорж╛ржг: ${mintQuantity}`);
    console.log(`   - ржорзЛржЯ ржЦрж░ржЪ: ${ethers.formatEther(totalCost)} ETH`);

    // рзк. ржорж┐ржирзНржЯ ржлрж╛ржВрж╢ржи ржХрж▓ ржХрж░рж╛ (ржЧрзНржпрж╛рж╕ ржлрж┐ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ ржирж┐рж░рзНржзрж╛рж░рж┐ржд рж╣ржмрзЗ)
    // тЪая╕П ржХржирзНржЯрзНрж░рж╛ржХрзНржЯрзЗрж░ mint ржлрж╛ржВрж╢ржирзЗрж░ ржирж╛ржо ржнрж┐ржирзНржи рж╣рж▓рзЗ 'mint' рж╢ржмрзНржжржЯрж┐ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржиред
    const tx = await contract.mint(mintQuantity, { value: totalCost });

    console.log(`тП│ ржЯрзНрж░рж╛ржиржЬрзНржпрж╛ржХрж╢ржи ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝рзЗржЫрзЗред рж╣рзНржпрж╛рж╢: ${tx.hash}`);
    console.log("ржЯрзНрж░рж╛ржиржЬрзНржпрж╛ржХрж╢ржи ржирж┐рж╢рзНржЪрж┐ржд рж╣ржУржпрж╝рж╛рж░ ржЬржирзНржп ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...");

    const receipt = await tx.wait();

    console.log("\nЁЯОЙ ржЕржнрж┐ржиржирзНржжржи! ржорж┐ржирзНржЯ рж╕ржлрж▓ рж╣ржпрж╝рзЗржЫрзЗ!");
    console.log(`ЁЯФЧ Etherscan-ржП ржжрзЗржЦрзБржи: https://etherscan.io/tx/${receipt.hash}`);

  } catch (error) {
    console.error("\nтЭМ ржПржХржЯрж┐ рждрзНрж░рзБржЯрж┐ ржШржЯрзЗржЫрзЗ:");
    // Ethers ржерзЗржХрзЗ ржЖрж╕рж╛ ржЖрж╕рж▓ ржХрж╛рж░ржгржЯрж┐ ржжрзЗржЦрж╛ржирзЛрж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ
    console.error(error.reason || error.message);
  }
}

main();
